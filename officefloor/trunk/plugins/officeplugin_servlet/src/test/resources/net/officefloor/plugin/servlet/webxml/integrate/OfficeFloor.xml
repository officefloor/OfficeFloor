<context>
	<!-- Provides surrounding configuration for a web.xml file to enable it 
		to be run within OfficeFloor. This is provided to test the web.xml SectionSource 
		implementation. -->
	<office-floor>
		<teams>
			<team name="SERVLET_TEAM" source="ONE_PERSON" />
			<team name="ACCEPTER_TEAM" source="WORKER_PER_TASK" />
			<team name="LISTENER_TEAM" source="WORKER_PER_TASK" />
		</teams>
		<managed-object-sources>
			<managed-object-source name="HTTP_APPLICATION_LOCATION"
				source="net.officefloor.plugin.web.http.location.HttpApplicationLocationManagedObjectSource"
				object-type="net.officefloor.plugin.web.http.location.HttpApplicationLocation">
				<properties>
					<property name="http.port" value="${port}" />
				</properties>
				<managing-office name="OFFICE" />
			</managed-object-source>
			<managed-object-source name="SERVLET_SERVER"
				source="net.officefloor.plugin.servlet.host.ServletServerManagedObjectSource"
				object-type="net.officefloor.plugin.servlet.host.ServletServer">
				<managing-office name="OFFICE" />
			</managed-object-source>
			<managed-object-source name="HTTP_CONNECTION"
				source="net.officefloor.plugin.socket.server.http.source.HttpServerSocketManagedObjectSource"
				object-type="net.officefloor.plugin.socket.server.http.ServerHttpConnection">
				<properties>
					<property name="port" value="${port}" />
				</properties>
				<managing-office name="OFFICE" />
				<input-managed-object name="HTTP_CONNECTION" />
				<flow name="HANDLE_HTTP_REQUEST"
					argument-type="net.officefloor.plugin.socket.server.http.ServerHttpConnection">
					<office-input office="OFFICE" section="WEB_XML" input="service" />
				</flow>
				<team name="accepter">
					<office-floor-team name="ACCEPTER_TEAM" />
				</team>
				<team name="listener">
					<office-floor-team name="LISTENER_TEAM" />
				</team>
				<team name="cleanup">
					<office-floor-team name="SERVLET_TEAM" />
				</team>
			</managed-object-source>
		</managed-object-sources>
		<input-managed-objects>
			<input-managed-object name="HTTP_CONNECTION"
				object-type="net.officefloor.plugin.socket.server.http.ServerHttpConnection">
				<bound-managed-object-source name="HTTP_CONNECTION" />
			</input-managed-object>
		</input-managed-objects>
		<managed-objects>
			<managed-object name="HTTP_APPLICATION_LOCATION"
				scope="PROCESS">
				<managed-object-source name="HTTP_APPLICATION_LOCATION" />
				<dependency name="SERVER_HTTP_CONNECTION"
					object-type="net.officefloor.plugin.socket.server.http.ServerHttpConnection">
					<input-managed-object name="HTTP_CONNECTION" />
				</dependency>
			</managed-object>
			<managed-object name="SERVLET_SERVER" scope="PROCESS">
				<managed-object-source name="SERVLET_SERVER" />
				<dependency name="HTTP_APPLICATION_LOCATION"
					object-type="net.officefloor.plugin.web.http.location.HttpApplicationLocation">
					<managed-object name="HTTP_APPLICATION_LOCATION" />
				</dependency>
			</managed-object>
		</managed-objects>
		<offices>
			<office name="OFFICE" source="OFFICE" location="office">
				<input section="WEB_XML" input="service" />
				<object name="SERVLET_SERVER"
					object-type="net.officefloor.plugin.servlet.host.ServletServer">
					<managed-object name="SERVLET_SERVER" />
				</object>
				<object name="HTTP_CONNECTION"
					object-type="net.officefloor.plugin.socket.server.http.ServerHttpConnection">
					<input-managed-object name="HTTP_CONNECTION" />
				</object>
				<team name="SERVLET_TEAM">
					<office-floor-team name="SERVLET_TEAM" />
				</team>
			</office>
		</offices>
	</office-floor>

	<office>
		<teams>
			<team name="SERVLET_TEAM" />
		</teams>
		<external-managed-objects>
			<external-managed-object name="SERVLET_SERVER"
				object-type="net.officefloor.plugin.servlet.host.ServletServer"
				object-scope="PROCESS" />
			<external-managed-object name="HTTP_CONNECTION"
				object-type="net.officefloor.plugin.socket.server.http.ServerHttpConnection"
				object-scope="PROCESS" />
		</external-managed-objects>
		<managed-object-sources>
			<managed-object-source name="REQUEST_ATTRIBUTES"
				source="net.officefloor.plugin.web.http.application.HttpRequestStateManagedObjectSource"
				object-type="net.officefloor.plugin.web.http.application.HttpRequestState" />
			<managed-object-source name="HTTP_SESSION"
				source="net.officefloor.plugin.web.http.session.HttpSessionManagedObjectSource"
				object-type="net.officefloor.plugin.web.http.session.HttpSession"
				timeout="10000" />
			<managed-object-source name="HTTP_SECURITY_SOURCE"
				source="net.officefloor.plugin.web.http.security.HttpSecurityManagedObjectSource"
				object-type="net.officefloor.plugin.web.http.security.HttpSecurity"
				timeout="10000">
				<input-dependency name="HTTP_SECURITY_SERVICE">
					<managed-object name="HTTP_SECURITY_SERVICE" />
				</input-dependency>
				<team name="AUTHENTICATOR">
					<office-team name="SERVLET_TEAM" />
				</team>
			</managed-object-source>
			<managed-object-source name="HTTP_SECURITY_SERVICE"
				source="net.officefloor.plugin.web.http.security.HttpSecurityServiceManagedObjectSource"
				object-type="net.officefloor.plugin.web.http.security.HttpSecurityService">
				<properties>
					<property name="http.security.service.authentication.scheme"
						value="BASIC" />
					<property name="http.security.basic.realm" value="TestRealm" />
				</properties>
			</managed-object-source>
			<managed-object-source name="CREDENTIAL_STORE"
				source="net.officefloor.plugin.web.http.security.store.PasswordFileManagedObjectSource"
				object-type="net.officefloor.plugin.web.http.security.store.CredentialStore">
				<properties>
					<property name="password.file.path" value="${password.file.location}" />
				</properties>
			</managed-object-source>
		</managed-object-sources>
		<managed-objects>
			<managed-object name="REQUEST_ATTRIBUTES" scope="PROCESS">
				<managed-object-source name="REQUEST_ATTRIBUTES" />
			</managed-object>
			<managed-object name="HTTP_SESSION" scope="PROCESS">
				<managed-object-source name="HTTP_SESSION" />
				<dependency name="HTTP_CONNECTION"
					object-type="net.officefloor.plugin.socket.server.http.ServerHttpConnection">
					<external-managed-object name="HTTP_CONNECTION" />
				</dependency>
			</managed-object>
			<managed-object name="HTTP_SECURITY" scope="PROCESS">
				<managed-object-source name="HTTP_SECURITY_SOURCE" />
				<dependency name="HTTP_SECURITY_SERVICE"
					object-type="net.officefloor.plugin.web.http.security.HttpSecurityService">
					<managed-object name="HTTP_SECURITY_SERVICE" />
				</dependency>
			</managed-object>
			<managed-object name="HTTP_SECURITY_SERVICE" scope="PROCESS">
				<managed-object-source name="HTTP_SECURITY_SERVICE" />
				<dependency name="HTTP_CONNECTION"
					object-type="net.officefloor.plugin.socket.server.http.ServerHttpConnection">
					<external-managed-object name="HTTP_CONNECTION" />
				</dependency>
				<dependency name="HTTP_SESSION"
					object-type="net.officefloor.plugin.socket.server.http.session.HttpSession">
					<managed-object name="HTTP_SESSION" />
				</dependency>
				<dependency name="Dependency-CREDENTIAL_STORE"
					object-type="net.officefloor.plugin.web.http.security.store.CredentialStore">
					<managed-object name="CREDENTIAL_STORE" />
				</dependency>
			</managed-object>
			<managed-object name="CREDENTIAL_STORE" scope="PROCESS">
				<managed-object-source name="CREDENTIAL_STORE" />
			</managed-object>
		</managed-objects>
		<sections>
			<section name="WEB_XML"
				source="net.officefloor.plugin.servlet.webxml.WebXmlSectionSource"
				location="net/officefloor/plugin/servlet/webxml/integrate/${web.xml.file.name}">
				<input name="service" />
				<output name="unhandled" escalation-only="false">
					<section-input section="DESK" input="unhandled" />
				</output>
				<object name="SERVLET_SERVER"
					object-type="net.officefloor.plugin.servlet.host.ServletServer">
					<external-managed-object name="SERVLET_SERVER" />
				</object>
				<object name="HTTP_CONNECTION"
					object-type="net.officefloor.plugin.socket.server.http.ServerHttpConnection">
					<external-managed-object name="HTTP_CONNECTION" />
				</object>
				<object name="REQUEST_ATTRIBUTES"
					object-type="net.officefloor.plugin.web.http.application.HttpRequestState">
					<managed-object name="REQUEST_ATTRIBUTES" />
				</object>
				<object name="HTTP_SESSION"
					object-type="net.officefloor.plugin.web.http.session.HttpSession">
					<managed-object name="HTTP_SESSION" />
				</object>
				<object name="HTTP_SECURITY"
					object-type="net.officefloor.plugin.web.http.security.HttpSecurity">
					<managed-object name="HTTP_SECURITY" />
				</object>
				<responsibility name="RESPONSIBILITY">
					<team name="SERVLET_TEAM" />
				</responsibility>
			</section>
			<section name="DESK" source="DESK" location="desk">
				<input name="unhandled" />
				<responsibility name="RESPONSIBILITY">
					<team name="SERVLET_TEAM" />
				</responsibility>
			</section>
		</sections>
	</office>

	<desk>
		<works>
			<work name="work" source="CLASS">
				<properties>
					<property name="class.name"
						value="net.officefloor.plugin.servlet.webxml.integrate.MockPostServicer" />
				</properties>
				<work-task name="unhandled" />
			</work>
		</works>
		<tasks>
			<task name="unhandled" public="true" work="work" task="unhandled" />
		</tasks>
	</desk>
</context>