                                               -----------------------
                                              Dynamic HTTP Server Example 
                                               -----------------------
					        Daniel Sagenschneider
                                               -----------------------

  <<Dynamic Http Server Example>>

  This example demonstrates the concept of the {{{/apidocs/net/officefloor/frame/api/execute/Task.html}Task}} within an OfficeFloor by rendering a dynamic web page. 
  
Code

%{code-snippet|sh-params=highlight:[5]|brush-autodetect=1|id=example|file=${basedir}/src/main/java/net/officefloor/example/dynamichttpserver/DynamicHttpServer.java}

  The above code will start the HTTP Server with a dynamic template available at url <<<http://localhost:7878/example>>> where the web page is rendered from two template files:
  
   * <<<Template.ofp>>> which contains the HTML template.
   
   * <<<TemplateLogic.class>>> which contains the dynamic logic of the template.
   
* Template.ofp

  The below is the content of the <<<Template.ofp>>>.

%{code-snippet|brush=xml|file=${basedir}/src/main/resources/Template.ofp}

  First thing to notice is that the template can be rendered in a web browser.  The focus is to ensure that web page content can be generated by web page designer tools and the template rendered in a web browser for quick checking (or possibly by the web page designer tools to aid page creation).  This is deliberate to allow graphic designers to focus on presentation of the pages rather than having to understand scripting tags and to an extent programming constructs.  It also means the template can be viewed without having to have the developer code available.

  To provide the developer dynamic control of rendering the template, there are non-obtrusive hooks for controlling the dynamic rending of the page.  The two hooks used in the above template are:
  
   * <<< <!-- [TaskName] --> >>> : which delimits content of the template into {{{/apidocs/net/officefloor/frame/api/execute/Task.html}Task}} instances.  Note that it is only the task name surrounding by the square brackets within the comment.  Adding other content outside the square brackets will have OfficeFloor consider it just a comment.
   
   * <<< $\{name\} >>> : which substitutes dynamic values for rending to the page
  
  The second hook just provides means to dynamically load bean property values from java classes into the page.  The first hook however is the important aspect as it delimits the template into sections for dynamic rendering.  The sections for the above example are:
  
   * <<<Template>>> (name of first section)
   
   * <<<Customer>>>
   
   * <<<ShoppingCartItems>>>
   
   * <<<EndItems>>>
   
  The content of these sections is after the delimiter to the next delimiter, so for <<<ShoppingCartItems>>> it would be:
  
+---------------------------------
        <tr>
            <td>${name}</td>
            <td>${price}</td>
            <td>${quantity}</td>
        </tr>
+---------------------------------  	
  
* TemplateLogic Class

  The <<<TemplateLogic>>> class has two methods that correspond to <<<Template.ofp>>> via naming conventions (method name is the template section name prefixed with <<<get>>> to obtain the java object providing the bean properties).  Note that only template sections containing a $\{tag\} entry must have a corresponding <<<getXxx()>>> method within the template logic class.

%{code-snippet|brush-autodetect=1|id=example|file=${basedir}/src/main/java/net/officefloor/example/dynamichttpserver/TemplateLogic.java}

  The <<<TemplateLogic>>> class has been kept simple in this example returning static content.  Use of dependency injection into the methods will allow retrieving values from the HTTP session or database but is beyond the scope of this example.

  After instantiating a <<<TemplateLogic>>> via its default constructor, the execution of the template is as follows:
    
   [[1]] The <<<Template>>> section of <<<Template.ofp>>> is rendered
   
   [[1]] <<<getCustomer()>>> is reflectively invoked on the <<<TemplateLogic>>> instance returning the <<<Customer>>> object
   
   [[1]] The <<<Customer>>> section of <<<Template.ofp>>> is rendered replacing $\{name\} with the value returned from <<<getName()>>> from above <<<Customer>>> object
   
   [[1]] <<<getShoppingCartItems()>>> is reflectively invoked on the <<<TemplateLogic>>> instance returning the <<<ShoppingCartItem>>> array
   
   [[1]] The <<<ShoppingCartItems>>> section content from <<<Template.ofp>>> is rendered for each <<<ShoppingCartItem>>> instance within the above returned array (in this case twice).  The $\{name\}, $\{price\}, $\{quantity\} are replaced with the corresponding bean properties from the current <<<ShoppingCartItem>>> instance being rendered.
   
   [[1]] The <<<EndItems>>> section of <<<Template.ofp>>> is rendered
  
  Each of the above steps is its own {{{/apidocs/net/officefloor/frame/api/execute/Task.html}Task}} within OfficeFloor and are strung together and executed sequentially to render the dynamic web page.  The order of {{{/apidocs/net/officefloor/frame/api/execute/Task.html}Task}} execution can be altered along with having different threads execute each {{{/apidocs/net/officefloor/frame/api/execute/Task.html}Task}}.  This however is beyond the scope of this example which was to show the break down of dynamic web page rendering into {{{/apidocs/net/officefloor/frame/api/execute/Task.html}Task}} instances.
   
  The resulting rendered HTML page is:
  
%{code-snippet|brush=xml|file=${basedir}/src/test/resources/Expected.html}


* Remaining Classes

  The remaining classes follow the java bean conventions and are included below for completeness of the example.

** Customer Class  

%{code-snippet|brush-autodetect=1|id=example|file=${basedir}/src/main/java/net/officefloor/example/dynamichttpserver/Customer.java}

** ShoppingCartItem Class

%{code-snippet|brush-autodetect=1|id=example|file=${basedir}/src/main/java/net/officefloor/example/dynamichttpserver/ShoppingCartItem.java}

Unit Test

  The unit test requests the dynamic web page from the HTTP Server and validates the page against expected content.

%{code-snippet|brush-autodetect=1|id=test|file=${basedir}/src/test/java/net/officefloor/example/dynamichttpserver/DynamicHttpServerTest.java}

