<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
	<modelVersion>4.0.0</modelVersion>
	<parent>
		<groupId>net.officefloor</groupId>
		<artifactId>officefloor</artifactId>
		<version>0.1.0</version>
		<relativePath>../../pom.xml</relativePath>
	</parent>
	<artifactId>net.officefloor.update.site
	</artifactId>
	<name>Eclipse Update Site</name>
	<description>
		Generates update site content for OfficeFloor in Eclipse.
	</description>
	<packaging>pom</packaging>
	<properties>
		<update.site.package.dir>${project.build.directory}/update_site_package_dir
		</update.site.package.dir>
	</properties>
	<build>
		<plugins>
			<plugin>
				<!-- Work around for eclipse:eclipse for this pom project. -->
				<artifactId>maven-eclipse-plugin</artifactId>
				<configuration>
					<packaging>jar</packaging>
				</configuration>
			</plugin>
			<plugin>
				<artifactId>maven-enforcer-plugin</artifactId>
				<executions>
					<execution>
						<id>enforce-property</id>
						<goals>
							<goal>enforce</goal>
						</goals>
						<configuration>
							<rules>
								<requireProperty>
									<property>eclipse.install.dir</property>
									<message><![CDATA[
Missing property: 'eclipse.install.dir'

Please ensure property 'eclipse.install.dir' is specified in an external active profile. Its value should contain the directory path to where Eclipse is installed (eg C:\install).

Also ensure the 'startup.jar' is available in the installed directory. This may require coping and renaming from the plug-in.
                                   ]]></message>
								</requireProperty>
								<requireProperty>
									<property>equinox.version</property>
									<message><![CDATA[
Missing property: 'equinox.version'

Please ensure property 'equinox.version' is specified in an external active profile. Its value should contain the version of equinox used by 'eclipse.install.dir'
									]]></message>
								</requireProperty>
							</rules>
							<fail>true</fail>
						</configuration>
					</execution>
				</executions>
			</plugin>
			<plugin>
				<artifactId>maven-dependency-plugin</artifactId>
				<executions>
					<execution>
						<id>copy-update-site-content</id>
						<phase>prepare-package</phase>
						<goals>
							<goal>copy-dependencies</goal>
						</goals>
						<configuration>
							<outputDirectory>${update.site.package.dir}
							</outputDirectory>
							<overWriteIfNewer>true</overWriteIfNewer>
						</configuration>
					</execution>
				</executions>
			</plugin>
			<plugin>
				<artifactId>maven-antrun-plugin</artifactId>
				<executions>
					<execution>
						<id>build-update-site-content</id>
						<phase>prepare-package</phase>
						<goals>
							<goal>run</goal>
						</goals>
						<configuration>
							<tasks>
								<ant dir="${project.basedir}" antfile="build-update-site-content.xml"
									target="build-update-site-content">
									<property name="BUILD_DIR"
										value="${update.site.package.dir}" />
									<property name="P2_LAUNCH_JAR"
										value="${eclipse.install.dir}/plugins/org.eclipse.equinox.launcher_${equinox.version}.jar" />
									<property name="OFFICE_FLOOR_VERSION" value="${pom.version}" />
								</ant>
							</tasks>
						</configuration>
					</execution>
					<execution>
						<id>deploy-update-site-content</id>
						<phase>deploy</phase>
						<goals>
							<goal>run</goal>
						</goals>
						<configuration>
							<tasks>
								<echo>Deploying the update site content to SourceForge</echo>
								<exec dir="${update.site.package.dir}" executable="rsync" failonerror="true">
									<arg line="-e ssh -r . sagenschneider,officefloor@frs.sourceforge.net:/home/frs/project/o/of/officefloor/eclipse/update" />
								</exec>
							</tasks>
						</configuration>
					</execution>
				</executions>
			</plugin>
			<plugin>
				<artifactId>maven-assembly-plugin</artifactId>
				<executions>
					<execution>
						<id>update-site-zip</id>
						<phase>package</phase>
						<goals>
							<goal>single</goal>
						</goals>
						<configuration>
							<descriptors>
								<descriptor>update-site-assembly.xml</descriptor>
							</descriptors>
						</configuration>
					</execution>
				</executions>
			</plugin>
		</plugins>
	</build>
	<dependencies>
		<dependency>
			<groupId>${pom.groupId}</groupId>
			<artifactId>net.officefloor.feature
			</artifactId>
			<version>${pom.version}</version>
			<scope>runtime</scope>
		</dependency>
		<dependency>
			<groupId>${pom.groupId}</groupId>
			<artifactId>net.officefloor.plugins.feature
			</artifactId>
			<version>${pom.version}</version>
			<scope>runtime</scope>
		</dependency>
	</dependencies>
	<distributionManagement>
		<repository>
			<id>Ignore</id>
			<name>Ignore as using ant to deploy</name>
			<url>file://${java.io.tmpdir}</url>
		</repository>
	</distributionManagement>
</project>