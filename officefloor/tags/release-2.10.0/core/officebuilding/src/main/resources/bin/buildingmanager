#!/bin/sh

# Fail immediately
set -e

# Default OFFICE_FLOOR_HOME to bin/..
if [ -z ${OFFICE_FLOOR_HOME} ]; then
	# Move to OFFICE_FLOOR_HOME directory
	SCRIPT=`readlink -f $0`
	BIN_DIR=`dirname $SCRIPT`

	# Default the OFFICE_FLOOR_HOME location
	export OFFICE_FLOOR_HOME=${BIN_DIR}/..
fi

# Load the properties
. ${OFFICE_FLOOR_HOME}/config/OfficeFloor.properties

# Connect to PID if not remote host
OFFICE_BUILDING_HOST=$1
if [ -z ${OFFICE_BUILDING_HOST} ]; then

    # Obtain the pid of OfficeBuilding process
    OFFICE_BUILDING_PID=`ps -aef | egrep [j]ava.*OfficeBuilding.*start | awk '{print $2}'`

    # Connect to local process
    jconsole ${OFFICE_BUILDING_PID} 

    # Run console locally so now quit
    exit
fi

# Default port
OFFICE_BUILDING_PORT=$2
if [ -z ${OFFICE_BUILDING_PORT} ]; then
    OFFICE_BUILDING_PORT=13778
fi

# Start jconcole trusting SSL certificate
jconsole -J-Djavax.net.ssl.trustStore=${key_store} \
         -J-Djavax.net.ssl.trustStorePassword=${key_store_password} \
         service:jmx:rmi://${OFFICE_BUILDING_HOST}:${OFFICE_BUILDING_PORT}/jndi/rmi://${OFFICE_BUILDING_HOST}:${OFFICE_BUILDING_PORT}/OfficeBuilding
